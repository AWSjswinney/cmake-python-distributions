env:
  - MANYLINUX_IMAGE=manylinux-x64 MANYLINUX_PYTHON=cp27-cp27mu
  - MANYLINUX_IMAGE=manylinux-x86 MANYLINUX_PYTHON=cp27-cp27mu
  - MANYLINUX_IMAGE=manylinux-x64 MANYLINUX_PYTHON=cp33-cp33m
  - MANYLINUX_IMAGE=manylinux-x86 MANYLINUX_PYTHON=cp33-cp33m
  - MANYLINUX_IMAGE=manylinux-x64 MANYLINUX_PYTHON=cp34-cp34m
  - MANYLINUX_IMAGE=manylinux-x86 MANYLINUX_PYTHON=cp34-cp34m
  - MANYLINUX_IMAGE=manylinux-x64 MANYLINUX_PYTHON=cp35-cp35m
  - MANYLINUX_IMAGE=manylinux-x86 MANYLINUX_PYTHON=cp35-cp35m

command:
  - if [[ -e ~/docker/$MANYLINUX_IMAGE.tar ]]; then docker load -i ~/docker/$MANYLINUX_IMAGE.tar; fi
  - docker pull dockcross/$MANYLINUX_IMAGE
  - mkdir -p ~/docker; docker save dockcross/$MANYLINUX_IMAGE > ~/docker/$MANYLINUX_IMAGE.tar
  - docker run dockcross/$MANYLINUX_IMAGE > dockcross-$MANYLINUX_IMAGE
  - chmod +x ./dockcross-$MANYLINUX_IMAGE
  - MANYLINUX_RUN_ENV=./dockcross-$MANYLINUX_IMAGE MANYLINUX_PYTHON=$MANYLINUX_PYTHON MAKEFLAGS=-j$(grep -c processor /proc/cpuinfo) ci before_install
  - MANYLINUX_RUN_ENV=./dockcross-$MANYLINUX_IMAGE MANYLINUX_PYTHON=$MANYLINUX_PYTHON MAKEFLAGS=-j$(grep -c processor /proc/cpuinfo) ci install
  - MANYLINUX_RUN_ENV=./dockcross-$MANYLINUX_IMAGE MANYLINUX_PYTHON=$MANYLINUX_PYTHON MAKEFLAGS=-j$(grep -c processor /proc/cpuinfo) ci before_build
  - MANYLINUX_RUN_ENV=./dockcross-$MANYLINUX_IMAGE MANYLINUX_PYTHON=$MANYLINUX_PYTHON MAKEFLAGS=-j$(grep -c processor /proc/cpuinfo) ci build
  - MANYLINUX_RUN_ENV=./dockcross-$MANYLINUX_IMAGE MANYLINUX_PYTHON=$MANYLINUX_PYTHON MAKEFLAGS=-j$(grep -c processor /proc/cpuinfo) ci test
  - MANYLINUX_RUN_ENV=./dockcross-$MANYLINUX_IMAGE MANYLINUX_PYTHON=$MANYLINUX_PYTHON MAKEFLAGS=-j$(grep -c processor /proc/cpuinfo) ci after_test
