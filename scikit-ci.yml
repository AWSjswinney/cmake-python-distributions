schema_version: "0.5.0"

before_install:

  environment:
    SCIKIT_CI_ADDONS_VERSION: 0.1.0
    PYTHON: python
    RUN_ENV: ""

  appveyor:
    environment:
      PYTHON: $<PYTHON_DIR>\\python.exe
      RUN_ENV: .\\..\\ci\\appveyor\\run-with-visual-studio.cmd
    commands:
      - git clone -b $<SCIKIT_CI_ADDONS_VERSION> git://github.com/scikit-build/scikit-ci-addons ../ci
      - python ../ci/appveyor/patch_vs2008.py
      - python ../ci/appveyor/install_cmake.py 3.6.2

  circle:
    environment:
      PYTHON: /opt/python/$<MANYLINUX_PYTHON>/bin/python
      RUN_ENV: $<MANYLINUX_RUN_ENV>

  travis:
    linux:
      commands:
        - git clone -b $<SCIKIT_CI_ADDONS_VERSION> git://github.com/scikit-build/scikit-ci-addons ../ci
        - python ../ci/travis/install_cmake.py 3.6.2
    osx:
      environment:
        RUN_ENV: ../ci/travis/run-with-pyenv.sh
      commands:
        - git clone -b $<SCIKIT_CI_ADDONS_VERSION> git://github.com/scikit-build/scikit-ci-addons ../ci
        - python ../ci/travis/install_pyenv.py
        - python ../ci/travis/install_cmake.py 3.6.2

install:
  commands:
    - $<RUN_ENV> $<PYTHON> -m pip install --disable-pip-version-check --upgrade pip
    - $<RUN_ENV> $<PYTHON> -m pip install -r requirements-dev.txt

build:
  commands:
    - $<RUN_ENV> $<PYTHON> setup.py build

after_test:
  commands:
    - $<RUN_ENV> $<PYTHON> setup.py sdist
    - $<RUN_ENV> $<PYTHON> setup.py bdist_wheel
